# Python CAD Framework (Build123d Based)

Современная модульная CAD-система на базе библиотеки `build123d`, использующая принципы функционального моделирования и иерархических сборок.

## Архитектура проекта

Проект разделен на логические уровни для обеспечения масштабируемости и чистоты кода:

### 1. Проекты и Детали (`projects/`)
Здесь содержатся конкретные реализации CAD-моделей. Каждая деталь — это функция, которая:
- Принимает геометрические параметры.
- Возвращает объект `Part`.
- Объявляет свои "интерфейсы подключения" через **Joints** (`RigidJoint` и др.).
- **Принцип**: Детали строятся в локальных координатах и не знают о своем итоговом положении в мире.

### 2. Сборки (`assembly.py` внутри проектов)
Сборки управляют композицией деталей. 
- Создают экземпляры деталей.
- Соединяют их, выстраивая дерево зависимостей через атрибуты `parent` и `children`.
- Результатом работы является объект `Compound`, содержащий всё дерево.

### 3. Системные модули (`src/`)
- **`renderer.py`**: Отвечает за визуализацию через PyVista (PBR материалы, освещение, края).
- **`ui.py`**: Управляет окном PySide6 и взаимодействием с пользователем.

## Основные принципы проектирования (Architecture Guidelines)

Чтобы избежать проблем с геометрической несовместимостью, следуйте этим правилам:

### 1. Стабильная сборка (v0.10.0)
В текущей версии библиотеки метод `connect_to()` может вызывать нежелательные перевороты или микро-смещения базы.
**Рекомендуемый подход:** Используйте джойнты как метаданные для позиционирования, но трансформацию задавайте явно через матрицы в сборке:
`child.location = base.location * base.joints["target"].location * child.joints["mount"].location.inverse()`

### 2. Принцип Z-Zero
Нижняя функциональная плоскость основной детали всегда должна быть в `Z=0`. Это гарантирует, что детали не «разъедутся» по высоте при объединении. Всегда явно указывайте `align=(..., ..., Align.MIN)`.

### 3. Локальные координаты (Local-First Design)
Каждая деталь строится в своей собственной системе координат. Плоскость стыка симметричных деталей должна быть мировым нулем (`X=0`).

## Как добавить новую деталь

1. Создайте файл в папке вашего проекта (например, `projects/my_project/part.py`).
2. Опишите функцию, возвращающую `Part` с настроенными `RigidJoint`.
3. В файле `assembly.py` импортируйте вашу функцию.
4. Добавьте деталь в сборку и соедините её с существующими компонентами, следуя правилам позиционирования.

## Запуск
```bash
python3 main.py
```

---
Разработано с использованием `build123d`, `pyvista` и `PySide6`.
